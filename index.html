<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CameChat - Conectando Pessoas</title>
    <link rel="stylesheet" href="style.css">
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-storage-compat.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"></script>
    <script>
        // Defina a URL do backend quando estiver online (ex.: https://seu-backend.onrender.com)
        window.CAMECHAT_BACKEND_URL = 'https://camechat.onrender.com';
    </script>
</head>
<body>
    <!-- Tela de Login/Cadastro -->
    <div id="auth-container" class="auth-container">
        <div class="auth-box">
            <div class="auth-header">
                <h1>CameChat</h1>
                <p class="subtitle">Fa√ßa login ou crie sua conta</p>
            </div>
            
            <!-- Abas de navega√ß√£o -->
            <div class="auth-tabs">
                <button id="tab-login" class="auth-tab active">Entrar</button>
                <button id="tab-register" class="auth-tab">Cadastrar</button>
            </div>
            
            <!-- Formul√°rio de Login -->
            <form id="login-form" class="auth-form active">
                <div class="form-group">
                    <label for="login-email">E-mail</label>
                    <input type="email" id="login-email" placeholder="seu@email.com" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Senha</label>
                    <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                
                <div class="form-options">
                    <label class="checkbox-container">
                        <input type="checkbox" id="remember-me">
                        <span class="checkmark"></span>
                        Lembrar-me
                    </label>
                    <a href="#" id="forgot-password" class="forgot-link">Esqueceu a senha?</a>
                </div>
                
                <button type="submit" class="btn-primary">Entrar</button>
                
                <div class="divider">
                    <span>ou</span>
                </div>
                
                <button type="button" id="btn-google-login" class="btn-google">
                    <img src="https://www.google.com/favicon.ico" alt="Google" class="google-icon">
                    Entrar com Google
                </button>
            </form>
            
            <!-- Formul√°rio de Cadastro -->
            <form id="register-form" class="auth-form">
                <div class="form-group">
                    <label for="register-photo">Foto de perfil</label>
                    <input type="file" id="register-photo" accept="image/*" required>
                    <div class="photo-preview">
                        <img id="register-photo-preview" src="" alt="Pr√©via da foto">
                    </div>
                </div>
                <div class="form-group">
                    <label for="register-name">Nome completo</label>
                    <input type="text" id="register-name" placeholder="Seu nome" required>
                </div>
                <div class="form-group">
                    <label for="register-email">E-mail</label>
                    <input type="email" id="register-email" placeholder="seu@email.com" required>
                </div>
                <div class="form-group">
                    <label for="register-password">Senha</label>
                    <input type="password" id="register-password" placeholder="M√≠nimo 6 caracteres" required>
                </div>
                <div class="form-group">
                    <label for="register-confirm-password">Confirmar senha</label>
                    <input type="password" id="register-confirm-password" placeholder="Digite novamente" required>
                </div>
                <div class="form-group">
                    <label for="register-role">Tipo de usu√°rio</label>
                    <select id="register-role" required>
                        <option value="user_chat" selected>Usu√°rio do chat</option>
                        <option value="administrador" id="register-role-admin">Administrador</option>
                    </select>
                    <small class="form-hint">O primeiro cadastro ser√° administrador automaticamente.</small>
                </div>
                
                <button type="submit" class="btn-primary">Criar conta</button>
                
                <div class="divider">
                    <span>ou</span>
                </div>
                
                <button type="button" id="btn-google-register" class="btn-google">
                    <img src="https://www.google.com/favicon.ico" alt="Google" class="google-icon">
                    Cadastrar com Google
                </button>
            </form>
            
            <!-- Modal de recupera√ß√£o de senha -->
            <div id="forgot-modal" class="modal">
                <div class="modal-content">
                    <span id="forgot-close-modal" class="close-modal">&times;</span>
                    <h3>Recuperar senha</h3>
                    <p>Digite seu e-mail para receber o link de redefini√ß√£o:</p>
                    <input type="email" id="reset-email" placeholder="seu@email.com" class="modal-input">
                    <button id="btn-reset-password" class="btn-primary">Enviar link</button>
                </div>
            </div>
        </div>
    </div>

    <!-- App principal -->
    <div id="app" class="app hidden">
        <div id="sidebar-overlay" class="sidebar-overlay"></div>
        <!-- Sidebar -->
        <aside class="sidebar">
            <header class="sidebar-header">
                <img id="user-photo" src="" alt="foto" class="user-avatar">
                <div class="user-info-header">
                    <span id="user-name"></span>
                    <small id="user-status">Online</small>
                    <span id="user-role-badge" class="role-badge hidden">Administrador</span>
                </div>
                <div class="sidebar-actions">
                    <button id="btn-admin-panel" class="admin-btn hidden">Admin</button>
                    <button id="btn-logout" class="logout-btn">Sair</button>
                </div>
            </header>
            
            <div class="search-box">
                <input type="text" id="search-user" placeholder="Buscar usu√°rio...">
            </div>

            <div class="add-friend-box">
                <input type="email" id="friend-email" placeholder="E-mail para adicionar">
                <button id="btn-add-friend" class="btn-add-friend" type="button">Adicionar</button>
            </div>
            
            <div class="users-header">
                <h3>Conversas</h3>
                <span id="total-users"></span>
            </div>
            
            <ul id="users-list" class="users-list"></ul>
        </aside>

        <!-- √Årea de chat -->
        <div class="main-panel">
            <main id="chat-panel" class="chat-area">
                <header class="chat-header" id="chat-header">
                    <button id="btn-toggle-sidebar" class="btn-icon btn-toggle-sidebar" title="Contatos">&#9776;</button>
                    <img id="chat-partner-photo" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect width='64' height='64' fill='%23e8f0fe'/><circle cx='32' cy='24' r='12' fill='%23002776'/><path d='M12 58c4-12 16-18 20-18s16 6 20 18' fill='%23002776'/></svg>" data-default-src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect width='64' height='64' fill='%23e8f0fe'/><circle cx='32' cy='24' r='12' fill='%23002776'/><path d='M12 58c4-12 16-18 20-18s16 6 20 18' fill='%23002776'/></svg>" alt="foto" class="partner-avatar clickable">
                    <div class="chat-partner-info clickable">
                        <span id="chat-partner-name">Selecione um usu√°rio</span>
                        <small id="chat-partner-status"></small>
                        <span id="call-indicator" class="call-indicator hidden">Em chamada</span>
                    </div>
                    <button id="btn-video-call" class="btn-icon btn-video-call" disabled title="Chamada de v??deo">&#128249;</button>
                    <button id="btn-call" class="btn-icon btn-call" disabled title="Ligar">üìû</button>
                </header>
                
                <div id="messages-container" class="messages-container">
                    <div class="welcome-message">
                        <h3>Bem-vindo ao CameChat! üëã</h3>
                        <p>Selecione um usu√°rio para come√ßar a conversar.</p>
                    </div>
                </div>
                
                <div class="message-input-area">
                    <input type="text" id="message-input" placeholder="Digite sua mensagem..." disabled>
                    <input type="file" id="file-upload" style="display: none;">
                    <button id="btn-attach" class="btn-icon" disabled title="Anexar arquivo">üìé</button>
                    <button id="btn-emoji" class="btn-icon" disabled title="Emojis">üòä</button>
                    <button id="btn-send" class="btn-icon btn-send" disabled title="Enviar mensagem">‚û§</button>
                </div>
                <emoji-picker id="emoji-picker" class="emoji-picker hidden"></emoji-picker>
            </main>

            <section id="admin-panel" class="admin-panel hidden">
                <header class="admin-header">
                    <div>
                        <h2>Painel do Administrador</h2>
                        <p>Gerencie usu√°rios e visualize m√©tricas do sistema.</p>
                    </div>
                </header>

                <div id="admin-tabs" class="admin-tabs">
                    <button class="admin-tab active" type="button" data-tab="metrics">M&eacute;tricas</button>
                    <button class="admin-tab" type="button" data-tab="users">Usu&aacute;rios</button>
                    <button class="admin-tab" type="button" data-tab="create">Novo</button>
                </div>

                <div id="admin-metrics-section" class="admin-section">
                    <div class="admin-metrics">
                    <div class="metric-card">
                        <span class="metric-label">Total de usu√°rios</span>
                        <strong id="metric-total-users">0</strong>
                    </div>
                    <div class="metric-card">
                        <span class="metric-label">Administradores</span>
                        <strong id="metric-total-admins">0</strong>
                    </div>
                    <div class="metric-card">
                        <span class="metric-label">Usu√°rios online</span>
                        <strong id="metric-online-users">0</strong>
                    </div>
                </div>

                </div>

                <div class="admin-grid">
                    <div id="admin-users-section" class="admin-section admin-users">
                        <h3>Usu√°rios cadastrados</h3>
                        <ul id="admin-users-list" class="admin-users-list"></ul>
                    </div>

                    <div id="admin-create-section" class="admin-section admin-create">
                        <h3>Criar usu√°rio</h3>
                        <form id="admin-create-form">
                            <div class="form-group">
                                <label for="admin-create-name">Nome</label>
                                <input type="text" id="admin-create-name" placeholder="Nome completo" required>
                            </div>
                            <div class="form-group">
                                <label for="admin-create-email">E-mail</label>
                                <input type="email" id="admin-create-email" placeholder="email@dominio.com" required>
                            </div>
                            <div class="form-group">
                                <label for="admin-create-password">Senha</label>
                                <input type="password" id="admin-create-password" placeholder="M√≠nimo 6 caracteres" required>
                            </div>
                            <div class="form-group">
                                <label for="admin-create-role">Tipo de usu√°rio</label>
                                <select id="admin-create-role" required>
                                    <option value="user_chat" selected>Usu√°rio do chat</option>
                                    <option value="administrador">Administrador</option>
                                </select>
                            </div>
                            <button type="submit" class="btn-primary">Criar usu√°rio</button>
                        </form>
                    </div>
                </div>

                <div id="admin-edit-modal" class="modal">
                    <div class="modal-content">
                        <span id="admin-edit-close" class="close-modal">&times;</span>
                        <h3>Editar usu√°rio</h3>
                        <div class="form-group">
                            <label for="admin-edit-name">Nome</label>
                            <input type="text" id="admin-edit-name" required>
                        </div>
                        <div class="form-group">
                            <label for="admin-edit-email">E-mail</label>
                            <input type="email" id="admin-edit-email" readonly>
                        </div>
                        <div class="form-group">
                            <label for="admin-edit-role">Tipo de usu√°rio</label>
                            <select id="admin-edit-role" required>
                                <option value="user_chat">Usu√°rio do chat</option>
                                <option value="administrador">Administrador</option>
                            </select>
                        </div>
                        <button id="admin-edit-save" class="btn-primary">Salvar altera√ß√µes</button>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Modal de foto de perfil -->
    <div id="profile-modal" class="modal">
        <div class="modal-content profile-modal-content">
            <span id="profile-close-modal" class="close-modal">&times;</span>
            <h3>Foto de perfil</h3>
            <div class="profile-cropper">
                <div id="profile-crop-frame" class="crop-frame">
                    <img id="profile-crop-image" src="" alt="Foto de perfil">
                </div>
            </div>
            <div class="crop-controls">
                <label for="profile-zoom">Zoom</label>
                <input type="range" id="profile-zoom" min="1" max="3" step="0.01" value="1">
                <button id="profile-center-btn" class="btn-google" type="button">Centralizar</button>
            </div>
            <input type="file" id="profile-photo-input" accept="image/*" class="modal-input">
            <div class="profile-actions">
                <button id="profile-save-btn" class="btn-primary">Salvar</button>
                <button id="profile-cancel-btn" class="btn-google" type="button">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de dados do amigo -->
    <div id="friend-modal" class="modal">
        <div class="modal-content friend-modal-content">
            <span id="friend-close-modal" class="close-modal">&times;</span>
            <h3>Dados do amigo</h3>
            <div class="friend-preview">
                <img id="friend-preview-image" src="" alt="Foto do amigo">
            </div>
            <div class="friend-details">
                <p><strong>Nome:</strong> <span id="friend-detail-name"></span></p>
                <p><strong>E-mail:</strong> <span id="friend-detail-email"></span></p>
                <p><strong>Status:</strong> <span id="friend-detail-status"></span> <span id="friend-blocked-badge" class="blocked-badge hidden">Bloqueado</span></p>
            </div>
            <div class="friend-actions">
                <button id="friend-remove-btn" class="btn-google" type="button">Excluir amigo</button>
                <button id="friend-block-btn" class="btn-primary" type="button">Bloquear amigo</button>
                <button id="friend-unblock-btn" class="btn-google hidden" type="button">Desbloquear amigo</button>
            </div>
        </div>
    </div>

    <!-- Modal de chamada de voz -->
    <div id="call-modal" class="modal">
        <div class="modal-content call-modal-content">
            <h3 id="call-title">Chamada de voz</h3>
            <p id="call-status">Chamando...</p>
            <p id="call-countdown" class="call-countdown hidden">40s</p>
            <div class="call-user">
                <img id="call-user-photo" src="" alt="Foto do amigo">
                <strong id="call-user-name"></strong>
            </div>
            <div id="call-media" class="call-media hidden">
                <video id="remote-video" autoplay playsinline></video>
                <video id="local-video" autoplay muted playsinline></video>
            </div>
            <div class="call-actions">
                <button id="call-accept-btn" class="btn-primary" type="button">Atender</button>
                <button id="call-reject-btn" class="btn-google" type="button">Recusar</button>
                <button id="call-hangup-btn" class="btn-google" type="button">Desligar</button>
            </div>
        </div>
    </div>

    <audio id="local-audio" autoplay muted></audio>
    <audio id="remote-audio" autoplay></audio>

    <script src="script.js"></script>
</body>
</html>
